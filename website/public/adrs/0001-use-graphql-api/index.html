<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/gaia/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=gaia/livereload" data-no-instant defer></script>
  <!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="1. Use GraphQL as the Co-op Hub Interface Protocol# Date: 2026-02-05 Status: Accepted
Context# Project Gaia aims to build a distributed smart agriculture system where the “Co-op Hub” (the central management software) is not a black box, but a replaceable component.
The system faces the following requirements:
Swappability (Resyndication): A community of farmers must be able to replace the official Go implementation of the Hub with an alternative (e.g., Rust, Elixir, Python) without breaking their existing edge devices (Farm Nodes) or client tools. Client Diversity: The system must support the official Web Dashboard (SPA) while simultaneously enabling “Headless” operation via CLI tools, mobile apps, or third-party automation scripts created by farmers. Bandwidth Constraints: Farm environments often have poor connectivity. Clients need to request exact data requirements to minimize payload size (avoiding over-fetching). Strict Contract: There must be a clear, enforceable “Constitution” that defines what a Co-op is, independent of the implementation code. Decision# We will use GraphQL as the primary API paradigm for the Co-op Hub, specifically adopting a Schema-First approach.
">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/gaia/adrs/0001-use-graphql-api/">
  <meta property="og:site_name" content="Project Gaia">
  <meta property="og:title" content="Project Gaia">
  <meta property="og:description" content="1. Use GraphQL as the Co-op Hub Interface Protocol# Date: 2026-02-05 Status: Accepted
Context# Project Gaia aims to build a distributed smart agriculture system where the “Co-op Hub” (the central management software) is not a black box, but a replaceable component.
The system faces the following requirements:
Swappability (Resyndication): A community of farmers must be able to replace the official Go implementation of the Hub with an alternative (e.g., Rust, Elixir, Python) without breaking their existing edge devices (Farm Nodes) or client tools. Client Diversity: The system must support the official Web Dashboard (SPA) while simultaneously enabling “Headless” operation via CLI tools, mobile apps, or third-party automation scripts created by farmers. Bandwidth Constraints: Farm environments often have poor connectivity. Clients need to request exact data requirements to minimize payload size (avoiding over-fetching). Strict Contract: There must be a clear, enforceable “Constitution” that defines what a Co-op is, independent of the implementation code. Decision# We will use GraphQL as the primary API paradigm for the Co-op Hub, specifically adopting a Schema-First approach.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="adrs">


  <meta itemprop="name" content="Project Gaia">
  <meta itemprop="description" content="1. Use GraphQL as the Co-op Hub Interface Protocol# Date: 2026-02-05 Status: Accepted
Context# Project Gaia aims to build a distributed smart agriculture system where the “Co-op Hub” (the central management software) is not a black box, but a replaceable component.
The system faces the following requirements:
Swappability (Resyndication): A community of farmers must be able to replace the official Go implementation of the Hub with an alternative (e.g., Rust, Elixir, Python) without breaking their existing edge devices (Farm Nodes) or client tools. Client Diversity: The system must support the official Web Dashboard (SPA) while simultaneously enabling “Headless” operation via CLI tools, mobile apps, or third-party automation scripts created by farmers. Bandwidth Constraints: Farm environments often have poor connectivity. Clients need to request exact data requirements to minimize payload size (avoiding over-fetching). Strict Contract: There must be a clear, enforceable “Constitution” that defines what a Co-op is, independent of the implementation code. Decision# We will use GraphQL as the primary API paradigm for the Co-op Hub, specifically adopting a Schema-First approach.">
  <meta itemprop="wordCount" content="458">

<title>0001 Use Graphql API | Project Gaia</title>
<link rel="icon" href="/gaia/favicon.png" >
<link rel="manifest" href="/gaia/manifest.json">
<link rel="canonical" href="http://localhost:1313/gaia/adrs/0001-use-graphql-api/">
<link rel="stylesheet" href="/gaia/book.min.cc2c524ed250aac81b23d1f4af87344917b325208841feca0968fe450f570575.css" integrity="sha256-zCxSTtJQqsgbI9H0r4c0SRezJSCIQf7KCWj&#43;RQ9XBXU=" crossorigin="anonymous">


  <script defer src="/gaia/fuse.min.js"></script>
  <script defer src="/gaia/en.search.min.2505f960d8a9e4c81aaacc246be9bf0c9b6b11f4323c91ca2b5bb128a47594c8.js" integrity="sha256-JQX5YNip5Mgaqswka&#43;m/DJtrEfQyPJHKK1uxKKR1lMg=" crossorigin="anonymous"></script>



  
</head>
<body dir="ltr" class="book-kind-page book-type-adrs">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    
<aside class="book-menu">
  <div class="book-menu-content">
    
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/gaia/"><span>Project Gaia</span>
  </a>
</h2>


<div class="book-search hidden">
  <input id="book-search-input" type="text" 
    placeholder="Search"
    aria-label="Search"
    maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>
























</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>



  </div>
</aside>
 

    <div class="book-page">
      <header class="book-header hidden">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/gaia/icons/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>0001 Use Graphql API</h3>

  <label for="toc-control">
    
    <img src="/gaia/icons/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#context">Context</a></li>
    <li><a href="#decision">Decision</a></li>
    <li><a href="#consequences">Consequences</a>
      <ul>
        <li><a href="#positive">Positive</a></li>
        <li><a href="#negative">Negative</a></li>
      </ul>
    </li>
    <li><a href="#compliance">Compliance</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="1-use-graphql-as-the-co-op-hub-interface-protocol">1. Use GraphQL as the Co-op Hub Interface Protocol<a class="anchor" href="#1-use-graphql-as-the-co-op-hub-interface-protocol">#</a></h1>
<p>Date: 2026-02-05
Status: <strong>Accepted</strong></p>
<h2 id="context">Context<a class="anchor" href="#context">#</a></h2>
<p>Project Gaia aims to build a distributed smart agriculture system where the &ldquo;Co-op Hub&rdquo; (the central management software) is not a black box, but a replaceable component.</p>
<p>The system faces the following requirements:</p>
<ol>
<li><strong>Swappability (Resyndication):</strong> A community of farmers must be able to replace the official Go implementation of the Hub with an alternative (e.g., Rust, Elixir, Python) without breaking their existing edge devices (Farm Nodes) or client tools.</li>
<li><strong>Client Diversity:</strong> The system must support the official Web Dashboard (SPA) while simultaneously enabling &ldquo;Headless&rdquo; operation via CLI tools, mobile apps, or third-party automation scripts created by farmers.</li>
<li><strong>Bandwidth Constraints:</strong> Farm environments often have poor connectivity. Clients need to request exact data requirements to minimize payload size (avoiding over-fetching).</li>
<li><strong>Strict Contract:</strong> There must be a clear, enforceable &ldquo;Constitution&rdquo; that defines what a Co-op is, independent of the implementation code.</li>
</ol>
<h2 id="decision">Decision<a class="anchor" href="#decision">#</a></h2>
<p>We will use <strong>GraphQL</strong> as the primary API paradigm for the Co-op Hub, specifically adopting a <strong>Schema-First</strong> approach.</p>
<p>We will use the <strong><a href="https://github.com/99designs/gqlgen">gqlgen</a></strong> library for the Go implementation to enforce strict typing and code generation based on the schema.</p>
<p>The GraphQL Schema (<code>.graphql</code> files) will reside in the shared <code>pkg/</code> directory and will serve as the canonical &ldquo;Contract&rdquo; of the system.</p>
<h2 id="consequences">Consequences<a class="anchor" href="#consequences">#</a></h2>
<h3 id="positive">Positive<a class="anchor" href="#positive">#</a></h3>
<ul>
<li><strong>The Schema is the Contract:</strong> The GraphQL SDL (Schema Definition Language) acts as a machine-readable &ldquo;Constitution.&rdquo; Any backend implementation can claim compliance by adhering to this schema.</li>
<li><strong>Introspection:</strong> Alternative clients can query the schema to discover capabilities dynamically, lowering the barrier for farmers building custom tools.</li>
<li><strong>Efficient Data Loading:</strong> Clients (especially mobile or IoT aggregators) can fetch complex nested data (e.g., <code>Farm -&gt; Nodes -&gt; Sensors -&gt; LastReading</code>) in a single HTTP round-trip, which is critical for high-latency farm networks.</li>
<li><strong>Type Safety:</strong> Using <code>gqlgen</code> ensures that the Go implementation cannot drift from the defined schema. If the schema changes, the code fails to compile until the resolver is updated.</li>
</ul>
<h3 id="negative">Negative<a class="anchor" href="#negative">#</a></h3>
<ul>
<li><strong>Complexity:</strong> Implementing GraphQL resolvers is more complex than writing simple REST handlers. We must manage <strong>DataLoaders</strong> to prevent the &ldquo;N+1 Query Problem&rdquo; (performance degradation when fetching nested lists).</li>
<li><strong>Caching:</strong> Standard HTTP caching (CDNs, browser cache) is more difficult to implement with GraphQL than with REST. We will need to rely on client-side caching (e.g., in the SPA) or persisted queries if performance becomes an issue.</li>
<li><strong>Binary Data:</strong> GraphQL is poor at handling file uploads/downloads. We will likely need a side-channel REST endpoint for large binary blobs (e.g., firmware updates, logs).</li>
</ul>
<h2 id="compliance">Compliance<a class="anchor" href="#compliance">#</a></h2>
<ol>
<li>The schema files must be stored in <code>pkg/graph/schema.graphql</code>.</li>
<li>Any change to the API structure requires a Pull Request to the <code>pkg</code> module first.</li>
<li>The <code>apps/coop-hub</code> build pipeline must fail if the generated Go code is out of sync with the schema.</li>
</ol>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">

<div>

</div>

<div>

</div>

</div>







 
        
  
  <div class="book-comments">

</div>
  
 
        
        
  
 
        
  
  
    <script>(function(){document.querySelectorAll("pre:has(code)").forEach(e=>{e.addEventListener("click",e.focus),e.addEventListener("copy",function(t){if(t.preventDefault(),navigator.clipboard){const t=window.getSelection().toString()||e.textContent;navigator.clipboard.writeText(t)}})})})()</script>
  

      </footer>

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
  
  <aside class="book-toc">
    <div class="book-toc-content">
      
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#context">Context</a></li>
    <li><a href="#decision">Decision</a></li>
    <li><a href="#consequences">Consequences</a>
      <ul>
        <li><a href="#positive">Positive</a></li>
        <li><a href="#negative">Negative</a></li>
      </ul>
    </li>
    <li><a href="#compliance">Compliance</a></li>
  </ul>
</nav>



    </div>
  </aside>
  
 
  </main>

  
</body>
</html>




















