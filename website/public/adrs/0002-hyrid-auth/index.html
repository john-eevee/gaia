<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/gaia/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=gaia/livereload" data-no-instant defer></script>
  <!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="2. Hybrid Authentication (mTLS &#43; JWT) &amp; Database Revocation# Date: 2026-02-05 Status: Accepted
Context# The Co-op Hub must serve two distinct classes of clients with contradictory security requirements:
Farm Nodes (Hardware): Unattended, low-power devices. They require zero-touch authentication. mTLS (Mutual TLS) is the ideal standard here, as it authenticates the device at the connection layer using the hardware-burned identity. Farmers &amp; 3rd Party Tools (Humans/Software): Web Dashboards, Mobile Apps, and custom scripts. These clients typically cannot manage client-side certificates easily and expect standard Token-based auth (JWT) over HTTPS. The Privacy Constraint: Project Gaia enforces a “Privacy First” architecture. Data resides on the Farm Node by default. The Co-op Hub is a shared aggregation point, not a master controller. Therefore, authentication as a “Farmer” (via JWT) must not grant unrestricted access to the live Farm Node, but only to data the farmer has explicitly chosen to export/syndicate to the Hub.
">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/gaia/adrs/0002-hyrid-auth/">
  <meta property="og:site_name" content="Project Gaia">
  <meta property="og:title" content="Project Gaia">
  <meta property="og:description" content="2. Hybrid Authentication (mTLS &#43; JWT) &amp; Database Revocation# Date: 2026-02-05 Status: Accepted
Context# The Co-op Hub must serve two distinct classes of clients with contradictory security requirements:
Farm Nodes (Hardware): Unattended, low-power devices. They require zero-touch authentication. mTLS (Mutual TLS) is the ideal standard here, as it authenticates the device at the connection layer using the hardware-burned identity. Farmers &amp; 3rd Party Tools (Humans/Software): Web Dashboards, Mobile Apps, and custom scripts. These clients typically cannot manage client-side certificates easily and expect standard Token-based auth (JWT) over HTTPS. The Privacy Constraint: Project Gaia enforces a “Privacy First” architecture. Data resides on the Farm Node by default. The Co-op Hub is a shared aggregation point, not a master controller. Therefore, authentication as a “Farmer” (via JWT) must not grant unrestricted access to the live Farm Node, but only to data the farmer has explicitly chosen to export/syndicate to the Hub.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="adrs">


  <meta itemprop="name" content="Project Gaia">
  <meta itemprop="description" content="2. Hybrid Authentication (mTLS &#43; JWT) &amp; Database Revocation# Date: 2026-02-05 Status: Accepted
Context# The Co-op Hub must serve two distinct classes of clients with contradictory security requirements:
Farm Nodes (Hardware): Unattended, low-power devices. They require zero-touch authentication. mTLS (Mutual TLS) is the ideal standard here, as it authenticates the device at the connection layer using the hardware-burned identity. Farmers &amp; 3rd Party Tools (Humans/Software): Web Dashboards, Mobile Apps, and custom scripts. These clients typically cannot manage client-side certificates easily and expect standard Token-based auth (JWT) over HTTPS. The Privacy Constraint: Project Gaia enforces a “Privacy First” architecture. Data resides on the Farm Node by default. The Co-op Hub is a shared aggregation point, not a master controller. Therefore, authentication as a “Farmer” (via JWT) must not grant unrestricted access to the live Farm Node, but only to data the farmer has explicitly chosen to export/syndicate to the Hub.">
  <meta itemprop="wordCount" content="558">

<title>0002 Hyrid Auth | Project Gaia</title>
<link rel="icon" href="/gaia/favicon.png" >
<link rel="manifest" href="/gaia/manifest.json">
<link rel="canonical" href="http://localhost:1313/gaia/adrs/0002-hyrid-auth/">
<link rel="stylesheet" href="/gaia/book.min.cc2c524ed250aac81b23d1f4af87344917b325208841feca0968fe450f570575.css" integrity="sha256-zCxSTtJQqsgbI9H0r4c0SRezJSCIQf7KCWj&#43;RQ9XBXU=" crossorigin="anonymous">


  <script defer src="/gaia/fuse.min.js"></script>
  <script defer src="/gaia/en.search.min.2505f960d8a9e4c81aaacc246be9bf0c9b6b11f4323c91ca2b5bb128a47594c8.js" integrity="sha256-JQX5YNip5Mgaqswka&#43;m/DJtrEfQyPJHKK1uxKKR1lMg=" crossorigin="anonymous"></script>



  
</head>
<body dir="ltr" class="book-kind-page book-type-adrs">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    
<aside class="book-menu">
  <div class="book-menu-content">
    
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/gaia/"><span>Project Gaia</span>
  </a>
</h2>


<div class="book-search hidden">
  <input id="book-search-input" type="text" 
    placeholder="Search"
    aria-label="Search"
    maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>
























</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>



  </div>
</aside>
 

    <div class="book-page">
      <header class="book-header hidden">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/gaia/icons/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>0002 Hyrid Auth</h3>

  <label for="toc-control">
    
    <img src="/gaia/icons/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#context">Context</a></li>
    <li><a href="#decision">Decision</a>
      <ul>
        <li><a href="#data-scoping--privacy-rule">Data Scoping &amp; Privacy Rule</a></li>
      </ul>
    </li>
    <li><a href="#detailed-flow">Detailed Flow</a>
      <ul>
        <li><a href="#1-the-revocation-check">1. The Revocation Check</a></li>
        <li><a href="#2-the-identity-resolution">2. The Identity Resolution</a></li>
      </ul>
    </li>
    <li><a href="#consequences">Consequences</a>
      <ul>
        <li><a href="#positive">Positive</a></li>
        <li><a href="#negative">Negative</a></li>
      </ul>
    </li>
    <li><a href="#compliance">Compliance</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="2-hybrid-authentication-mtls--jwt--database-revocation">2. Hybrid Authentication (mTLS + JWT) &amp; Database Revocation<a class="anchor" href="#2-hybrid-authentication-mtls--jwt--database-revocation">#</a></h1>
<p>Date: 2026-02-05
Status: <strong>Accepted</strong></p>
<h2 id="context">Context<a class="anchor" href="#context">#</a></h2>
<p>The Co-op Hub must serve two distinct classes of clients with contradictory security requirements:</p>
<ol>
<li><strong>Farm Nodes (Hardware):</strong> Unattended, low-power devices. They require zero-touch authentication. mTLS (Mutual TLS) is the ideal standard here, as it authenticates the device at the connection layer using the hardware-burned identity.</li>
<li><strong>Farmers &amp; 3rd Party Tools (Humans/Software):</strong> Web Dashboards, Mobile Apps, and custom scripts. These clients typically cannot manage client-side certificates easily and expect standard Token-based auth (JWT) over HTTPS.</li>
</ol>
<p><strong>The Privacy Constraint:</strong>
Project Gaia enforces a <strong>&ldquo;Privacy First&rdquo;</strong> architecture. Data resides on the Farm Node by default. The Co-op Hub is a shared aggregation point, not a master controller. Therefore, authentication as a &ldquo;Farmer&rdquo; (via JWT) must not grant unrestricted access to the live Farm Node, but <em>only</em> to data the farmer has explicitly chosen to export/syndicate to the Hub.</p>
<p><strong>The Conflict:</strong>
Enforcing strict mTLS (<code>tls.RequireAndVerifyClientCert</code>) at the server level rejects all standard web clients. Additionally, maintaining an external OCSP responder contradicts the &ldquo;single binary&rdquo; deployment goal.</p>
<h2 id="decision">Decision<a class="anchor" href="#decision">#</a></h2>
<p>We will implement a <strong>Dual-Path Hybrid Authentication</strong> system on a single HTTPS port with strict Data Scoping.</p>
<ol>
<li><strong>TLS Configuration:</strong> The Hub will use <code>ClientAuth: tls.VerifyClientCertIfGiven</code>.</li>
<li><strong>Application-Layer Gating:</strong> We will implement a unified Authentication Middleware:
<ul>
<li><strong>Path A (Hardware):</strong> If a valid Client Certificate is present, the identity is resolved as <code>Role: NODE</code>.</li>
<li><strong>Path B (Software):</strong> If a valid JWT is present, the identity is resolved as <code>Role: FARMER</code>.</li>
</ul>
</li>
<li><strong>Local Revocation:</strong> We will &ldquo;blocklist&rdquo; certificates using the Hub&rsquo;s local database, checking serial numbers against a <code>revocations</code> table.</li>
</ol>
<h3 id="data-scoping--privacy-rule">Data Scoping &amp; Privacy Rule<a class="anchor" href="#data-scoping--privacy-rule">#</a></h3>
<p>Authentication does not imply data visibility. The Hub enforces a strict separation:</p>
<ul>
<li><strong>The Hub is NOT a Proxy:</strong> The Hub API will not forward queries to the live Farm Node to fetch private data.</li>
<li><strong>Export-Only Access:</strong> A user authenticated as <code>FARMER</code> can only query data that has been <strong>previously synchronized/exported</strong> from the Node to the Hub (e.g., aggregated yields, public proposals).</li>
<li><strong>Private by Default:</strong> Granular sensor logs, private journals, or raw operational data remaining on the Node are cryptographically inaccessible to the Hub&rsquo;s JWT scope.</li>
</ul>
<h2 id="detailed-flow">Detailed Flow<a class="anchor" href="#detailed-flow">#</a></h2>
<h3 id="1-the-revocation-check">1. The Revocation Check<a class="anchor" href="#1-the-revocation-check">#</a></h3>
<ul>
<li><strong>Table:</strong> <code>certificates</code> (columns: <code>serial_number</code>, <code>node_id</code>, <code>status</code>).</li>
<li><strong>Logic:</strong> If <code>cert_serial</code> is in the local blocklist cache, abort connection (403).</li>
</ul>
<h3 id="2-the-identity-resolution">2. The Identity Resolution<a class="anchor" href="#2-the-identity-resolution">#</a></h3>
<ul>
<li><strong>If Cert Valid:</strong> <code>Context.User = { Type: &quot;NODE&quot;, ID: Cert.CommonName }</code></li>
<li><strong>If JWT Valid:</strong> <code>Context.User = { Type: &quot;FARMER&quot;, ID: Token.Sub, Scope: &quot;EXPORTED_DATA_ONLY&quot; }</code></li>
<li><strong>If Neither:</strong> <code>Context.User = { Type: &quot;GUEST&quot; }</code></li>
</ul>
<h2 id="consequences">Consequences<a class="anchor" href="#consequences">#</a></h2>
<h3 id="positive">Positive<a class="anchor" href="#positive">#</a></h3>
<ul>
<li><strong>Privacy Compliance:</strong> The architecture technically guarantees that the Hub cannot be used to spy on a farm&rsquo;s private operations. Even if a Hub admin compromises the server, they only see data the farmer voluntarily exported.</li>
<li><strong>Unified Endpoint:</strong> Simplifies network config (single port) while supporting both Hardware (mTLS) and Software (JWT) clients.</li>
<li><strong>Zero-Infrastructure Revocation:</strong> No external OCSP responder required.</li>
</ul>
<h3 id="negative">Negative<a class="anchor" href="#negative">#</a></h3>
<ul>
<li><strong>Data Staleness:</strong> Since the Farmer only sees exported data, the Dashboard might show slightly outdated information compared to the live physical node.</li>
<li><strong>Replay Risk (JWT):</strong> Unlike mTLS, JWTs can be stolen. However, the scope of a stolen JWT is limited to public/syndicated data, not the farm&rsquo;s private control systems.</li>
</ul>
<h2 id="compliance">Compliance<a class="anchor" href="#compliance">#</a></h2>
<ol>
<li>All GraphQL resolvers must check the data source. If a query requires live data from a Node, it must be rejected for JWT users.</li>
<li>The <code>revocations</code> cache must have a short TTL (e.g., 5 minutes).</li>
</ol>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">

<div>

</div>

<div>

</div>

</div>







 
        
  
  <div class="book-comments">

</div>
  
 
        
        
  
 
        
  
  
    <script>(function(){document.querySelectorAll("pre:has(code)").forEach(e=>{e.addEventListener("click",e.focus),e.addEventListener("copy",function(t){if(t.preventDefault(),navigator.clipboard){const t=window.getSelection().toString()||e.textContent;navigator.clipboard.writeText(t)}})})})()</script>
  

      </footer>

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
  
  <aside class="book-toc">
    <div class="book-toc-content">
      
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#context">Context</a></li>
    <li><a href="#decision">Decision</a>
      <ul>
        <li><a href="#data-scoping--privacy-rule">Data Scoping &amp; Privacy Rule</a></li>
      </ul>
    </li>
    <li><a href="#detailed-flow">Detailed Flow</a>
      <ul>
        <li><a href="#1-the-revocation-check">1. The Revocation Check</a></li>
        <li><a href="#2-the-identity-resolution">2. The Identity Resolution</a></li>
      </ul>
    </li>
    <li><a href="#consequences">Consequences</a>
      <ul>
        <li><a href="#positive">Positive</a></li>
        <li><a href="#negative">Negative</a></li>
      </ul>
    </li>
    <li><a href="#compliance">Compliance</a></li>
  </ul>
</nav>



    </div>
  </aside>
  
 
  </main>

  
</body>
</html>




















